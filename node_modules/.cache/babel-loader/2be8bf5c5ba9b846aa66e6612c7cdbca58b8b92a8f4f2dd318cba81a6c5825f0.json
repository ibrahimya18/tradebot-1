{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useEffect, useState, useRef } from 'react';\nconst symbol = 'dogeusdt'; // Küçük harf, MEXC API buna dikkat eder\n\n// API zaman aralıkları: 1m, 5m, 15m, 1h, 4h, 1d vs.\nconst intervalMap = {\n  '15m': 'Min15',\n  '60m': 'Min60',\n  '4h': 'Hour4',\n  '1d': 'Day1'\n};\nexport default function useMexcCandles(interval = '15m') {\n  _s();\n  const [priceData, setPriceData] = useState([]);\n  const [currentPrice, setCurrentPrice] = useState(null);\n  const wsRef = useRef(null);\n  useEffect(() => {\n    const ws = new WebSocket('wss://wbs.mexc.com/ws');\n    wsRef.current = ws;\n    ws.onopen = () => {\n      const message = {\n        method: 'SUBSCRIPTION',\n        params: [`spot@public.kline.${symbol}.${intervalMap[interval]}`]\n      };\n      ws.send(JSON.stringify(message));\n    };\n    ws.onmessage = event => {\n      const response = JSON.parse(event.data);\n      if (response.d && response.d.k) {\n        const k = response.d.k;\n        const newCandle = {\n          x: new Date(k.t),\n          // timestamp -> x (Chart.js için)\n          o: parseFloat(k.o),\n          h: parseFloat(k.h),\n          l: parseFloat(k.l),\n          c: parseFloat(k.c)\n        };\n        setPriceData(prevData => {\n          const last = prevData[prevData.length - 1];\n          if (last && last.x.getTime() === newCandle.x.getTime()) {\n            return [...prevData.slice(0, -1), newCandle]; // Güncelle\n          } else {\n            return [...prevData.slice(-99), newCandle]; // 100 mumla sınırlı tut\n          }\n        });\n        setCurrentPrice(parseFloat(k.c));\n      }\n    };\n    ws.onerror = err => {\n      console.error('WebSocket error:', err);\n    };\n    ws.onclose = () => {\n      console.log('WebSocket closed');\n    };\n    return () => {\n      if (ws.readyState === WebSocket.OPEN) {\n        const unsubMessage = {\n          method: 'UNSUBSCRIPTION',\n          params: [`spot@public.kline.${symbol}.${intervalMap[interval]}`]\n        };\n        ws.send(JSON.stringify(unsubMessage));\n      }\n      ws.close();\n    };\n  }, [interval]);\n  return {\n    priceData,\n    currentPrice\n  };\n}\n_s(useMexcCandles, \"Dw5ZGZC2bvjIDJGWfMSvQmV/zEk=\");","map":{"version":3,"names":["useEffect","useState","useRef","symbol","intervalMap","useMexcCandles","interval","_s","priceData","setPriceData","currentPrice","setCurrentPrice","wsRef","ws","WebSocket","current","onopen","message","method","params","send","JSON","stringify","onmessage","event","response","parse","data","d","k","newCandle","x","Date","t","o","parseFloat","h","l","c","prevData","last","length","getTime","slice","onerror","err","console","error","onclose","log","readyState","OPEN","unsubMessage","close"],"sources":["C:/Users/VESTEL/Desktop/tradebot/src/components/CandleChart.jsx"],"sourcesContent":["import { useEffect, useState, useRef } from 'react';\r\n\r\nconst symbol = 'dogeusdt'; // Küçük harf, MEXC API buna dikkat eder\r\n\r\n// API zaman aralıkları: 1m, 5m, 15m, 1h, 4h, 1d vs.\r\nconst intervalMap = {\r\n  '15m': 'Min15',\r\n  '60m': 'Min60',\r\n  '4h': 'Hour4',\r\n  '1d': 'Day1',\r\n};\r\n\r\nexport default function useMexcCandles(interval = '15m') {\r\n  const [priceData, setPriceData] = useState([]);\r\n  const [currentPrice, setCurrentPrice] = useState(null);\r\n  const wsRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    const ws = new WebSocket('wss://wbs.mexc.com/ws');\r\n\r\n    wsRef.current = ws;\r\n\r\n    ws.onopen = () => {\r\n      const message = {\r\n        method: 'SUBSCRIPTION',\r\n        params: [`spot@public.kline.${symbol}.${intervalMap[interval]}`],\r\n      };\r\n      ws.send(JSON.stringify(message));\r\n    };\r\n\r\n    ws.onmessage = (event) => {\r\n      const response = JSON.parse(event.data);\r\n\r\n      if (response.d && response.d.k) {\r\n        const k = response.d.k;\r\n\r\n        const newCandle = {\r\n          x: new Date(k.t), // timestamp -> x (Chart.js için)\r\n          o: parseFloat(k.o),\r\n          h: parseFloat(k.h),\r\n          l: parseFloat(k.l),\r\n          c: parseFloat(k.c),\r\n        };\r\n\r\n        setPriceData((prevData) => {\r\n          const last = prevData[prevData.length - 1];\r\n          if (last && last.x.getTime() === newCandle.x.getTime()) {\r\n            return [...prevData.slice(0, -1), newCandle]; // Güncelle\r\n          } else {\r\n            return [...prevData.slice(-99), newCandle]; // 100 mumla sınırlı tut\r\n          }\r\n        });\r\n\r\n        setCurrentPrice(parseFloat(k.c));\r\n      }\r\n    };\r\n\r\n    ws.onerror = (err) => {\r\n      console.error('WebSocket error:', err);\r\n    };\r\n\r\n    ws.onclose = () => {\r\n      console.log('WebSocket closed');\r\n    };\r\n\r\n    return () => {\r\n      if (ws.readyState === WebSocket.OPEN) {\r\n        const unsubMessage = {\r\n          method: 'UNSUBSCRIPTION',\r\n          params: [`spot@public.kline.${symbol}.${intervalMap[interval]}`],\r\n        };\r\n        ws.send(JSON.stringify(unsubMessage));\r\n      }\r\n      ws.close();\r\n    };\r\n  }, [interval]);\r\n\r\n  return { priceData, currentPrice };\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}